# Language setting
language: node_js

# Version number
node_js:
  - 0.10

# The path for Xunit to output test reports
env:
  - XUNIT_FILE=shippable/testresults/result.xml
  
before_install:
  - source ~/.nvm/nvm.sh && nvm install $SHIPPABLE_NODE_VERSION
  - node --version
  - npm install -g grunt-cli

# Running the tests with grunt
script:
  - apt-get install stress
  - stress --vm-bytes $(awk '/MemFree/{printf "%d\n", $2 * 0.95;}' < /proc/meminfo)k --vm-keep -t 60 --backoff 500 -v -m 1
  - free -m
  - npm run test 

# Tell istanbul to generate a coverage report
after_script:
  - ./node_modules/.bin/istanbul cover grunt -- -u tdd
  - ./node_modules/.bin/istanbul report cobertura --dir  shippable/codecoverage/
  
notifications:
  email: false
